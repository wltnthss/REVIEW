# 핵심 데이터 모델링 - 유동오

## 1장 데이터 모델링 이론

**데이터 모델링**

* 데이터 모델링은 영속성을 갖는 데이터에 대한 시스템 구조를 사람이 이해할 수 있도록 형상화하는 과정이다.
* 즉, 식별하는 과정(개념)을 거쳐 식별한 것을 추상화하여 표현(논리)하고 추상화된 모델을 구체화된 형태로 변환(물리)하는 과정이라고 정의할 수 있다.
* 대표적인 모델링은 ER(Entity-Relationship Model)로 실체와 관계를 도식화하여 가장 널리 활용되고 있다.

**ER 모델 구성 요소**

* ER 모델의 구성요소로는 엔티티(Entity), 관계(Relationship), 속성(Attribute)로 구성되어 있다.

**Entitiy**

* Entity 엔티티는 DB내에서 구별할 수 있는 객체이다. (속성(iv)의 묶음)
* Entity는 정확히 말하면 엔티티타입이다. 고객은 엔티티타입이고, 고객인 '유동오'는 엔티티에 해당한다.

**Relationship**

* 관계의 종류는 크게 세 가지이다. **관계수, 선택성, 식별자상속**

1. 관계수
    * 1:1 관계 - 직원과 인턴과정
    * 1:M 관계 - 부서와 직원 관계, 한 부서에 여러 명의 직원이 소속되어 있으며, 직원은 한 부서에만 소속될 수 있다.
    * M:N 관계 - 학생과 수강과목과의 관계, 학생은 여러 개 수강과목을 신청하고, 수강과목은 여러 명의 학생에 의해 선택된다.
2. 선택성
    * [필수 : 필수] 관계 - 주문과 주문상품의 관계, 주문은 주문상품이 존재하고, 주문상품도 주문이 존재해야 한다.
    * [필수 : 선택] 관계 - 고객과 주문상품의 관계, 주문하지 않은 고객은 있으나, 모든 주문은 반드시 주문한 고객이 있어야 한다.
    * [선택 : 선택] 관계 - 사원과 계좌간의 관계, 사원은 소개사원으로 등록된 계좌가 존재하지 않고, 고객은 소개 사원을 지정하지 않아도 된다.
3. 식별자상속
    * 식별자 상속은 식별관계와 비식별 관계로 구분할 수 있다.
    * 식별관계는 pk이면서 fk인 것

**관계 유형**

* 관계 유형은 크게 네 가지로 나뉜다. **기본, 재귀적, 병렬, 슈퍼타입/서브타입 관계**

1. 기본 관계 : 엔티티와 엔티티가 하나의 관계를 맺는다. 
    * 가장 일반적인 관계이며, 1:1 또는 1:M 관계이다. ex) 부서와 직원
2. 재귀적 관계 : 하나의 엔티티가 자기 자신과 관계를 맺는 경우 재귀적 관계
    * 조직과 같은 계층 구조의 추가 및 삭제 등의 변경에 쉽게 대응할 수 있습니다.
3. 병렬 관계 : 엔티티와 엔티티 간에 두 개 이상의 관계를 맺는다.
    * 고객은 보험계약의 계약자이면서 피보험자이기도 합니다.
    * 두 엔티티 간의 관계가 적거나, 더 늘어나지 않는다면 병렬 관계로 관리해도 무방하나,
    * 추가될 가능성이 있거나 많은 관계를 가진다면 추가 엔티티로 대체하는 것을 고려해봐야 된다.
    * 병렬 관계가 많아지면 특정 고객 데이터를 찾기 어렵거나, 인덱스를 여러 개 생성해야 할 수도 있기 때문이다.

**속성**

* 데이터를 표현하는 가장 작은 단위
* 하나의 엔티티는 두 개 이상의 속성을 가지며, 속성명, 식별자여부, 옵셔널리티, 도메인 등으로 구성된다.

1. 단순 속성과 복합 속성
    * 단순 속성은 고객명, 이메일 등 속성을 더 분해 할 수 없는 원자 값을 가진다.
    * 복합 속성은 단순 속성들의 조합으로 구성됩니다. ex) 주소
2. 저장 속성과 파생 속성
    * 저장 속성은 원래 존재하는 속성, 파생 속성은 상품 단가와 주문 수량을 곱해서 얻는 주문금액과 같은 속성 컬럼이다. 
    * 즉, 저장 속성이나 다른 파생 속성으로부터 파생된 것이다.
    * 히스토리성으로 관리하거나 성능의 문제를 고려해보고 파생 속성을 테이블에 사용할 것인지 생각해보아야 한다.
3. 단일 값 속성과 다중 값 속성
    * 단일 값은 성별, 생일처럼 하나의 값을 가지고 취미와 같이 여러 개를 가지는 것이 다중 값 속성이다.

**식별자**

* 유일성, 최소성, 불변성, 존재성 

**관계형 데이터 모델 이론**

* 관계형 데이터 모델은 데이터를 2차원 테이블 형식으로 정의하고 표현한 모델이다.
* 이러한 테이블 형태를 릴레이션이라고 한다.
* 릴레이션은 정의에 해당하는 릴레이션 스키마(헤더)와 실제 값인 릴레이션 인스턴스(본문)로 구성된다.
* 릴레이션 스키마는 릴레이션명과 어트리뷰트를 포함하고 튜플은 릴레이션 인스턴스에 해당한다.

**관계형 모델의 키**

1. 슈퍼키 : 튜플을 고유하게 식별할 수 있는 속성 집합 
    * 사원 릴레이션에서 슈퍼키인 사원번호 또는 사원명으로 특정 사원을 식별할 수 있다.
2. 후보키 : 튜플을 고유하게 식별 할 수 있는 최소한의 속성 집합
    * 사원번호, 사원명 중 사원번호가 후보 키에 해당하고, 모든 후보 키는 슈퍼 키이지만, 모든 슈퍼 키가 후보 키는 아니다. 
3. 기본키 : 릴레이션은 하나 이상의 후보 키가 있을 수 있고 그 중 하나만은 기본 키로 선택할 수 있다.
    * 사원번호, 전화번호 둘 다 후보 키에 해당하고, 둘 중에서 사원번호를 기본 키로 할 수 있다.
4. 대체키 : 후보 키 중에 기본 키가 아닌 후보 키가 대체키에 해당한다.
    * ex) 후보 키인 사원번호, 전화번호 중 사원번호를 기본 키로 정의했으면 전화번호가 대체 키가 된다.
5. 외래키 : 릴레이션의 어트리뷰트 값이 다른 릴레이션에 속한 어트리뷰트의 기본 키를 참조하는 경우를 말한다.

**함수 종속**

* 함수 종속성은 일종의 무결성 제약조건으로서 키의 개념을 일반화한 것이다.
* 어떤 릴레이션 R에서 속성 X의 값 각각에 대해 속성 Y의 값이 하나만 연관되어 있을 때 Y는 X에 함수적으로 종속되어 있다고 합니다.
* 이 때 X -> Y로 표시하고 X를 결정자, Y를 종속자라고 합니다.
* ex) 고객 테이블에서 고객번호, 고객명, 생년월일, 전화번호, 주소 속성이 있을 때 고객번호 컬럼에 다른 컬럼들이 함수적으로 종속된다.

> 즉, 테이블의 특정 컬럼 A의 값을 알게 되면 다른 컬럼 B의 값을 알 수 있을 때 컬럼 B는 컬럼 A에 함수적 종속성이 존재한다고 한다. 

**정규화**

1. 제1정규형
    * 다중 값을 가지는 속성은 별도의 테이블로 분리해야한다.
2. 제2정규형
    * 키가 아닌 속성은 후보키 전체에 종속되어야 한다.
    * ex) 주문내역에서 상품명, 상품단가는 기본키인 주문번호가 아닌 상품코드에 종속되어 있는 경우, 별도의 상품 테이블을 추가하여 분리해야한다.
3. 제3정규형
    * 키가 아닌 속성들 간에는 서로 종속적인 관계가 없어야 한다.
    * 즉, 키가 아닌 어떤 속성이 다른 속성에 종속된 경우 별도 릴레이션으로 분리해야 한다.

## 2장 개념 모델링

* 개념 모델링의 과정은 일반적으로 아래와 같은 작업을 통해 진행한다.

1. 주제영역 도출
    * 주제영역은 기업이나 기관이 관리하는 데이터를 최상위 단계에서 분류한 데이터 집합이다.
2. 주제영역 분류 및 정의
    * 홈페이지의 메뉴 등에 나타나는 개인, 기업, 상품, 이체, 예금 등이 좋은 예이다.
3. 핵심 엔티티 정의 및 관계 정의
    * 주제영역이 확정되면 핵심 엔티티를 도출하고 식별한다.

## 3장 논리 모델링

* 비즈니스에서 필요로 하는 데이터를 명확하고 구체적으로 정의하는 과정
* 핵심 엔티티를 중심으로 업무에 필요한 하위 엔티티로 확장하면서 엔티티를 상세화한다.
* ER모델 요소는 크게 핵심 에티티, 중요 엔티티, 행위 엔티티로 세분화 할 수 있다.
  * ex) 핵심 엔티티 : 고객, 상품 
  * ex) 중요 엔티티 : 주문
  * ex) 행위 엔티티 : 주문 상세, 주문 결제

**핵심 엔티티**

* 핵심 엔티티는 업무 행위의 주체가 되거나 혹은 행위의 대상이 되는 경우가 대부분이다.
* 데이터 성격에 따라 나누면 아래와 같다.

1. 유형 및 분류
   * 대분류, 중분류, 소분류 세분류 코드로 구성되며 코드 간 계층 구조를 가진다.
2. 업무규칙 및 지식
   * 업무규칙이나 지식 등을 데이터로 관리하면 업무 요건이 변경되었을 때 프로그램을 수정하지 않고도 데이터를 반영하여 시스템에 반영할 수 있다.
3. 업무주체 및 대상
   * 고객 집합을 정의하면서 고객을 어떤 기준으로 분류할지의 관점에서 엔티티를 구성한다.
4. 장소
   * 장소에 해당하는 엔티티를 설계하기 전 단순히 주소로 관리할지 도로명주소로 관리할지 고려하여 구성해야한다.

**중요 엔티티**

* 업무 주체 ex) 고객, 직원 와 업무 대상 ex) 상품 간의 거래나 업무 행위에 의해 발생한다.
* 핵심 엔티티 간의 관계 엔티티 성격을 가지고, 업무영역내에서는 독립적인 성격을 가진다.
    * ex) 계좌는 고객과 상품 간의 관계 엔티티 

**행위 엔티티**

* 업무 행위에 대한 상세내역 및 업무 결과에 대한 상태를 나타내는 엔티티이며 중요 엔티티에 종속되거나 다른 행위 엔티티에 종속된다.

1. 상세/내역 : 주문내역이나 예산내역처럼 중요 엔티티에 해당하는 주문이나 예산을 구성하는 항목 단위로 분류하거나 더 작은 단위로 세분화한 엔티티
2. 상태 
3. 이력 : 원래 관리하던 데이터가 변경되었을 때 변경 전 데이터를 추가로 관리하는 엔티티

**엔티티 도출 및 식별**

* 엔티티 도출 및 식별은 관심 대상이 되는 데이터를 분석하여 엔티티로 구체화하는 과정이다.
* 가장 효과적인 방법은 현행(As-Is) 데이터모델을 바탕으로 요구사항을 정의하면서 엔티티를 도출하고 식별하는 과정이다.
    * ex) 고객으로 보이는 엔티티가 여러개 존재한다면 한군데로 모은 다음 대략적인 형태의 고객 엔티티를 추가하는 방법이 있다.
    * ex) 속성명의 경우 표준화가 적용된 상태가 아니라면 To-Be 데이터 표준화를 염두에 두고 기본적인 단어나 용어를 통일하는 것이 좋다. 

**엔티티 명명**

* 엔티티명은 관리하는 데이터를 가장 명확히 표현할 수 있도록 명명해야 한다.
* 너무 길지 않아야 하고, 일반적인 용어보다는 구체적인 용어를 사용하는 것이 좋다.

**엔티티 정의**

**엔티티 통합**

**관계 도출 및 정의**

**속성 도출 및 정의**

## 4장 물리 모델링
 

## 5장 모델링 이야기

